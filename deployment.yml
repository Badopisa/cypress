apiVersion: v1
kind: Service
metadata:
  name: sonalysis-web-service
  labels:
    app: sonalysis-web
spec:
  selector:
    app: sonalysis-web
  ports:
    - protocol: TCP
      port: 90
      targetPort: 9003
  type: NodePort

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sonalysis-web
  namespace: default
  labels:
    app: sonalysis-web
spec:
  replicas: 1
  selector:
    matchLabels:
      app: sonalysis-web
  template:
    metadata:
      labels:
        app: sonalysis-web

    spec:
      containers:
      - name: sonalysis-web
        image: parallelscore/sonalysis-web:main
        ports:
        - containerPort: 9003      
        imagePullPolicy: IfNotPresent
        # added below lines to test crashing error
        startupProbe:
          initialDelaySeconds: 1
          periodSeconds: 30
          timeoutSeconds: 30 
          exec:
            command:
            - pwd
---
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: cpu-scaledobject
  namespace: default
  labels:
    app: sonalysis-web
    deploymentName: sonalysis-web
spec:
  scaleTargetRef:
    name: sonalysis-web
  pollingInterval: 10  # Optional. Default: 30 seconds
  cooldownPeriod:  15 # Optional. Default: 300 seconds
  minReplicaCount: 1   # Optional. Default: 0
  maxReplicaCount: 10 # Optional. Default: 100
  triggers:
  - type: cpu
    metadata:
      type: Utilization
      value: "50"
